# かしこいママの暮らしノート

An application that generates affiliate blog posts from a keyword using the Google Gemini API, allowing users to review, edit, and publish them to a Firestore database.
 [demo](https://www.mama-note.okbmk.com/)

## Features

- **AI-Powered Content Creation**: Enter a keyword and get a complete, SEO-optimized blog post generated by the Gemini API.
- **Full Content Control**: Review and edit the AI-generated title and content before publishing.
- **Article Management (CRUD)**:
  - **Publish**: Save your articles to Firestore.
  - **View**: Read your published articles.
  - **Update**: Edit and save changes to existing articles.
  - **Delete**: Remove articles you no longer need.
- **Modern UI**: A clean, responsive interface built with React and Tailwind CSS.
- **Role-Based Access Control**: Admin-only access for creating, editing, and deleting articles. Public users can only view articles.

## Tech Stack

- **Frontend**: [React](https://react.dev/) (with TypeScript)
- **Build Tool**: [Vite](https://vitejs.dev/)
- **Styling**: [Tailwind CSS](https://tailwindcss.com/)
- **AI Model**: [Google Gemini API](https://ai.google.dev/) (`@google/genai`)
- **Authentication & Database**: [Firebase Authentication](https://firebase.google.com/docs/auth), [Firebase Firestore](https://firebase.google.com/docs/firestore)

## Getting Started

Follow these instructions to set up and run the project locally.

### Prerequisites

- [Node.js](https://nodejs.org/) (version 18 or higher recommended)
- A Google Gemini API Key
- A Firebase project with Firestore and Google Authentication enabled

### 1. git Repository

```bash
$ git init
$ git branch -M main
$ git commit -m "first commit"
$ git remote add origin git@github.com:S-okubomy/blog-gem-ai-2508.git
#
git clone git@github.com:S-okubomy/ai-blog-20250803.git
cd ai-blog-20250803
```

### 2. Set Up Environment Variables

This project requires API keys and configuration from both Google and Firebase to function.

1.  Create a new file named `.env.local` in the root of the project.
2.  Copy the contents of `.env.example` into your new `.env.local` file.
3.  Fill in the required values:

#### **Gemini API Key**

- Go to [Google AI Studio](https://aistudio.google.com/app/apikey) to get your API key.
- Add it to `.env` as `API_KEY`.

#### **Firebase Configuration**

- Go to your [Firebase Console](https://console.firebase.google.com/).
- Select your project (or create a new one).
- In your Project Settings (click the gear icon ⚙️), scroll down to the "Your apps" section.
- If you don't have a web app, create one.
- Find and copy the `firebaseConfig` object.
- Add each value from the config object to the corresponding variable in your `.env` file.
- **Enable Google Sign-in**: In the Firebase console, go to `Authentication` > `Sign-in method` and enable `Google` as a provider.

#### **Admin User**
- Specify the Google account email address that will have admin privileges.
- Add it to `.env` as `ADMIN_EMAIL`.

Your `.env` file should look like this:

```
# Gemini API Key (from https://aistudio.google.com/app/apikey)
API_KEY="YOUR_GEMINI_API_KEY_HERE"

# Firebase Configuration (from your Firebase project settings)
FIREBASE_API_KEY="YOUR_FIREBASE_API_KEY_HERE"
FIREBASE_AUTH_DOMAIN="YOUR_PROJECT_ID.firebaseapp.com"
FIREBASE_PROJECT_ID="YOUR_PROJECT_ID"
FIREBASE_STORAGE_BUCKET="YOUR_PROJECT_ID.appspot.com"
FIREBASE_MESSAGING_SENDER_ID="YOUR_SENDER_ID"
FIREBASE_APP_ID="YOUR_APP_ID"

# Admin user's email address
ADMIN_EMAIL="your.admin.email@example.com"
```

### 3. Install Dependencies

```bash
nvm install --lts
nvm use --lts
node -v
 #v22.18.0
npm install
```

### 4. Run the Development Server

```bash
npm run dev
```

The application should now be running on `http://localhost:5173` (or another port if 5173 is in use).

## Available Scripts

- `npm run dev`: Starts the development server.
- `npm run build`: Builds the app for production.
- `npm run preview`: Serves the production build locally.

### 5. GCPへのデプロイ手順

#### 1：デプロイ用の設定ファイルを作成
```
Dockerfile
cloudbuild.yaml
.dockerignore
```

#### 2：Google Cloud SDK
##### 1 Google Cloud SDK (gcloud CLI) をインストール & ログイン
##### 2 初期設定
```
# 1. GCPアカウントにログインします (ブラウザが開きます)
gcloud auth login

# 2. 作業対象のGCPプロジェクトIDを設定します
gcloud config set project blog-mama-2508

# 3. GCPの各種サービスを有効にする
gcloud services enable run.googleapis.com artifactregistry.googleapis.com cloudbuild.googleapis.com

# 4. Dockerイメージを保存する場所（リポジトリ）を作成
gcloud artifacts repositories create my-app-repo \
  --repository-format=docker \
  --location=us-west1 \
  --description="かしこいママの暮らしノートのリポジトリ"

```

##### 3 Cloud Buildへのアクセス許可

[Google Cloud ConsoleのIAMページ](https://console.cloud.google.com/iam-admin/iam) で設定
```
# 1 Google Cloud ConsoleのIAMページ をブラウザで開く
（対象プロジェクトが選択されていることを確認してください）
# 2メンバーのリストの中から、@cloudbuild.gserviceaccount.com で終わるメールアドレスのようなものを見つけます。
（例: 1234567890@cloudbuild.gserviceaccount.com）
# 3 その行の右端にある鉛筆アイコン（プリンシパルを編集）をクリック
# 4「ロールを編集」という画面が開きます。「別のロールを追加」ボタンをクリック
# 5「ロールを選択」というフィールドに「Secret Manager のシークレット アクセサー」と入力または検索し、表示されたロールを選択
# 6 右下の「保存」ボタンをクリック
```

##### 4 APIキーをSecret Managerに保管
[Google Cloud Secret Manager](https://console.cloud.google.com/security/secret-manager) で設定
```
コンソール → セキュリティ → Secret Manager
（対象プロジェクトが選択されていることを確認）
シークレットのリストが表示されます。まず、FIREBASE_PROJECT_ID をクリックします。
画面上部にある「新しいバージョンを追加」をクリックします。
「シークレットの値」入力
キーがない場合は「シークレット作成」
```

##### 5 クラウドビルド & デプロイ
```
# クラウドビルド
gcloud builds submit --config cloudbuild.yaml .

#デプロイ
gcloud run deploy kashikoi-mama-note --image us-west1-docker.pkg.dev/blog-mama-2508/my-app-repo/my-app:latest --platform managed --region us-west1 --allow-unauthenticated
```

#### 3：Firebaseの設定
##### 1 セキュリティルールを設定する
[Firebase ConsoleのFirestore Databaseページ](https://console.firebase.google.com/project/_/firestore/rules)で設定
```
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // 記事(articles)コレクションに対するルール
    match /articles/{articleId} {
      // 誰でも記事を読むことができます (get, list)
      allow read: if true;
      
      // 認証済みで、かつメールアドレスが指定の管理者である場合のみ
      // 書き込み（作成、更新、削除）を許可します
      allow write: if request.auth != null && request.auth.token.email == 'YOUR_ADMIN_EMAIL@example.com';
    }
  }
}
```

##### 2 承認済みドメイン
[FirebaseコンソールのAuthenticationページ](https://console.firebase.google.com/project/_/authentication/settings )で設定

```
ページの上部にある「Settings」タブ（または「設定」タブ）をクリック
「承認済みドメイン」（Authorized domains）で、
「ドメインを追加」（Add domain）ボタンをクリック
表示された入力欄に、デプロイしたアプリケーションのドメイン名（URLの https:// を除いた部分）を入力します。
Cloud RunのURLが https://kashikoi-mama-note-xxxx.run.app の場合、入力するのは kashikoi-mama-note-xxxx.run.app
「ログイン方法」タブ）をクリック、「Google」が「有効」（Enabled）になっていることを確認
```

### 6. ドメイン取得方法
GCP側での設定: 「このドメインを、Cloud Runのこのサービスで使います」とGoogleに教える。
お名前.com側での設定: 「このドメインにアクセスが来たら、Googleのサーバーに繋いでください」と設定する。
#### 1 ：GCPでカスタムドメインをマッピングする
Google Cloud ConsoleのCloud Runページ をブラウザで開きます。（対象プロジェクトが選択されていることを確認）
サービスの一覧から、デプロイしたサービス名をクリックします。
サービスの詳細画面の上部にある「カスタムドメインをマッピング」（MAP CUSTOM DOMAINS）をクリック
マッピングするドメインを入力: ここに、お名前.comで取得したドメインを www 付きで入力します。（例: www.kashikoi-mama-note.com）
「続行」（CONTINUE）ボタンをクリックします。
google consoleのリンクも確認して、画面に従う
#### 2 ：お名前ドットコムでドメインの所有権を確認し、DNSレコードを設定
お名前.com Navi にログインして、「DNS関連機能の設定」に進みます。
入力が完了したら、ページ下部の「確認画面へ進む」ボタンを押し、内容を確認してから「設定する」ボタンをクリックして完了
※10分以上かかるので、しばらく待ってから確認
